services:
  - type: web
    name: sri-robot-audit-web
    env: python
    plan: free

    buildCommand: |
      echo "==== üß± INICIANDO BUILD SRI ROBOT AUDIT ===="
      pip install --upgrade pip
      pip install -r requirements.txt

      # 1Ô∏è‚É£ Instalar dependencias del sistema para Playwright
      python -m playwright install-deps

      # 2Ô∏è‚É£ Instalar navegadores directamente en la ruta esperada
      mkdir -p /root/.cache/ms-playwright
      PLAYWRIGHT_BROWSERS_PATH=/root/.cache/ms-playwright python -m playwright install chromium

      # 3Ô∏è‚É£ Verificar instalaci√≥n exitosa
      echo "==== ‚úÖ NAVEGADORES DISPONIBLES ===="
      find /root/.cache/ms-playwright -type f -name "headless_shell" || true

    startCommand: |
      # 4Ô∏è‚É£ Variables de entorno requeridas
      export PLAYWRIGHT_BROWSERS_PATH=/root/.cache/ms-playwright
      export PYPPETEER_HOME=/root/.cache/ms-playwright
      export STREAMLIT_SERVER_PORT=$PORT
      export STREAMLIT_SERVER_HEADLESS=true
      export STREAMLIT_SERVER_ADDRESS=0.0.0.0

      echo "==== üöÄ INICIANDO APLICACI√ìN SRI ROBOT AUDIT ===="
      streamlit run aplicacion.py --server.port $PORT --server.address 0.0.0.0

    autoDeploy: true
